# 索引
InnoDB存储引擎支持以下几种常见的索引：
## B+树索引
> B+树中的B代表平衡（balance）,因为B+树是从最早的平衡二叉树演化而来。
* B+树索引并不能找到一个给定键值的具体行，能找到的只是被查找数据行所在的页，然后数据库通过把页读入到内存，再在内存中进行查找，最后得到要查找的数据。
### 二分查找法
例子： Page Directory
### 二分查找树和平衡二叉树（AVL）
### B+树
B+树由B树和索引顺序访问方法（ISAM）演化而来。
### B+树索引
B+树索引的本质就是B+树在数据库中的实现。在数据库中，B+树的高度一般都在2-4层，也就是说查找某一键值的行记录时最多只需要2到4次IO。
1. 聚集索引（clustered index）
> 按照每张表的主键构造一棵B+树，同时叶子节点中存放的即为整张表的行记录数据，也将聚集索引的叶子节点称为数据页。每个数据表都通过一个双向链表来进行链接。 

聚集索引对于那些经常要搜索范围值的列特别有效。使用聚集索引找到包含第一个值的行后，便可以确保包含后续索引值的行在物理相邻。例如，如果应用程序执行 的一个查询经常检索某一日期范围内的记录，则使用聚集索引可以迅速找到包含开始日期的行，然后检索表中所有相邻的行，直到到达结束日期。这样有助于提高此 类查询的性能。同样，如果对从表中检索的数据进行排序时经常要用到某一列，则可以将该表在该列上聚集（物理排序），避免每次查询该列时都进行排序，从而节 省成本。 

经典加密算法有三种： 
1. DES(Data Encryption Standard)：数据加密标准(现在用的比较少，因为它的加密强度不够，能够暴力破解) 
2. 3DES：原理和DES几乎是一样的，只是使用3个密钥，对相同的数据执行三次加密，增强加密强度。(缺点：要维护3个密钥，大大增加了维护成本) 
3. AES(Advanced Encryption Standard)：高级加密标准，目前美国国家安全局使用的，苹果的钥匙串访问采用的就AES加密。是现在公认的最安全的加密方式，是对称密钥加密中最流行的算法。

协程是一种用户态的轻量级线程，协程的调度完全由用户控制。从技术的角度来说，“协程就是你可以暂停执行的函数”。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。


2. 辅助索引（secondary index）
> 叶子节点并不包含行记录的全部数据。叶子节点除了包含键值以外，每个叶子节点中的索引行中还包含了一个书签（bookmark）。该书前用来告诉InnoDB存储引擎哪里可以找到与索引相对应的行数据。
### B+树索引的分裂
InnoDB存储引擎的Page Header中用来保存插入的顺序信息的字段：
1. PAGE_LAST_INSERT
2. PAGE_DIRECTION 决定向左还是向右进行分裂
3. PAGE_N_DIRECTION
## Cardinality值
Cardinality值表示索引中不重复记录数量的预估值。在高选择性属性的字段并从表中取出很少一部分时使用B+树索引才有意义。
## 全文索引
将存储于数据库中的整本书或整篇文章的的任意内容查找出来的技术。
### 倒排索引
## 哈希索引

# 锁
## lock于latch
1. latch称为闩锁（轻量级的锁），作用对象是线程，在InnoDB存储引擎中,latch又可以分为mutex(互斥量)和rwlock(读写锁)，用来保证并发线程操作临界资源的正确性。
2. lock的对象是事务，用来锁定数据库中的对象，如表、页、行，并且一般lock的对象仅在事务commit或rollback后进行释放，有死锁机制。
## InnoDB存储引擎中的锁
两种标准的行级锁：
1. 共享锁(S Lock),允许事务杜一行数据。
2. 排他锁(X Lock),允许事务删除或更新一行数据。
> 兼容是指对同一记录锁的兼容性情况，例如一个T1已经获得了行r的共享锁，那么另外的事务T2可以立即获得行r的共享锁，因为读取并没有改变行r的数据。
3. InnoDB存储引擎支持多粒度(granular)锁定，允许事务在行级上和表级上的锁同时存在。
4. 意向锁(Intention Lock)j将锁定的对象分为多个层次

意向共享锁(IS Lock)，事务想要获得一张表中某几行的共享锁。

意向排他锁(IS Lock)，事务想要获得一张表中某几行的排他锁。

由于InnoDB存储引擎支持的是行级别的锁，因此意向锁骑士不会阻塞除全表以外的任何请求。

* 一致性非锁定读(consistent nonlocking read)
1. 在RC事务隔离级别，对于快照数据，非一致性读总是读取被锁定行的最新一份快照数据，而在RR事务隔离级别，读取事务开始时的行数据版本。

* 一致性锁定读
1. Record Lock: 单个行记录上的锁
2. Gap Lock: 间隙锁，锁定一个范围，但不包含记录本身
3. Next-Key Lock: Gap Lock+Record Lock,锁定一个范围，并且锁定记录本身。采用Next-Key Locking机制来避免Plantom Problem(幻像问题，指在同一事务下，连续执行两次同样的SQL语句可能导致不同的结果，第二次的SQL语句可能会返回之前不存在的行)。用Next-Key Locking解决：不是锁住单个值，而是对一个范围加X锁，任何对这个范围的插入都是不被允许的。

## 死锁
死锁产生的四个充分必要条件：
1. 保持请求；
2. 资源不可剥夺；
3. 环路等待；
4. 资源互斥。
> 发现死锁后，InnoDB存储引擎会马上回滚一个事务。

## 备份与恢复
* Hot Backup(热备份)
数据库运行中直接备份，对正在运行的数据库操作没有任何的影响。Online Backup。
* Cold Backup(冷备份)
在数据库停止的情况下备份。
* Warm Backup(温备份)
在数据库运行中进行，会对当前数据库的操作有所影响。

### 按照备份后文件的内容
1. 逻辑备份，值备份出的文件内容是可读的，一般是文本文件。
2. 裸文件备份，值赋值数据库的物理文件。
### 按照备份数据库的内容来分
1. 完全备份，做一个完整的备份。
2. 增量备份，在上次完全备份的基础上对于更改的数据进行备份。
3. 日志备份，对二进制日志备份，通过对一个完全备份进行二进制日志的重做来完成数据库的point-in-time的恢复工作。